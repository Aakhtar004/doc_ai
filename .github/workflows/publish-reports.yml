name: ðŸš€ Publish All Reports to GH-Pages

on:
  workflow_run:
    workflows: 
      - "ðŸ” Code Analysis & Security"
      - "ðŸ§¬ Mutation Testing"
      - "ðŸ§ª BDD Tests"
    types: [ completed ]

jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ðŸ“ Prepare docs directories
        run: |
          rm -rf docs
          mkdir -p docs/reports/{coverage,security,mutation,bdd}

      - name: ðŸ“¥ Download coverage artifact
        uses: actions/download-artifact@v4
        with:
          name: coverage-reports
          path: docs/reports/coverage

      - name: ðŸ“¥ Download snyk artifact
        uses: actions/download-artifact@v4
        with:
          name: snyk-reports
          path: docs/reports/security

      - name: ðŸ“¥ Download semgrep artifact
        uses: actions/download-artifact@v4
        with:
          name: semgrep-results
          path: docs/reports/security

      - name: ðŸ“¥ Download mutation artifact
        uses: actions/download-artifact@v4
        with:
          name: mutation-reports
          path: docs/reports/mutation

      - name: ðŸ“¥ Download BDD artifact
        uses: actions/download-artifact@v4
        with:
          name: bdd-reports
          path: docs/reports/bdd

      - name: ðŸ“ Generate docs/index.md
        run: |
          cat > docs/index.md << 'EOF'
          # ðŸ“Š Dashboard de Reportes

          ## ðŸš€ Cobertura de CÃ³digo
          - [Cobertura HTML](reports/coverage/index.html)

          ## ðŸ›¡ï¸ Seguridad
          - [Snyk JSON](reports/security/snyk-report.json)
          - [Semgrep JSON](reports/security/semgrep-results.json)

          ## ðŸ§¬ Mutaciones
          - [Reporte Mutaciones HTML](reports/mutation/index.html)

          ## ðŸ§ª Pruebas BDD
          - [Reporte BDD HTML](reports/bdd/index.html)
          EOF

      - name: ðŸ“¤ Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
        with:
          path: docs
